# CVE-Search MCP Server Docker Image

基于 [roadwy/cve-search_mcp](https://github.com/roadwy/cve-search_mcp) 项目构建的 Docker 镜像。

## 项目简介

CVE-Search MCP Server 是一个 Model Context Protocol (MCP) 服务器，用于查询 [CVE-Search API](https://www.cve-search.org/api/)。提供全面的 CVE 漏洞信息查询功能，包括供应商、产品、特定 CVE 和最新漏洞信息。

## 功能特性

- **供应商查询**: 获取所有供应商列表
- **产品查询**: 获取特定供应商的所有产品
- **漏洞查询**: 获取特定供应商和产品的 CVE 漏洞信息
- **CVE 详情**: 根据 CVE ID 查询具体漏洞信息
- **最新 CVE**: 获取最新的 CVE 漏洞信息
- **数据库状态**: 获取 CVE 数据库更新状态

## 技术栈

- **语言**: Python 3.11
- **框架**: FastMCP (Model Context Protocol)
- **包管理**: uv
- **API**: CVE-Search API (https://cve.circl.lu/api/)
- **基础镜像**: python:3.11-slim

## 构建镜像

```bash
# 使用构建脚本
./build.sh

# 或指定标签
./build.sh v1.0.0

# 手动构建
docker build -t cve-search-mcp .
```

## 运行容器

### 基本运行（MCP stdio 模式）

```bash
docker run --rm cve-search-mcp
```

### 交互式运行

```bash
docker run --rm -it cve-search-mcp /bin/bash
```

### 测试 API 连接

```bash
docker run --rm cve-search-mcp curl -s https://cve.circl.lu/api/browse | head -20
```

## MCP 工具

镜像内置以下 MCP 工具：

| 工具名称 | 功能描述 | 参数 |
|---------|---------|------|
| `vul_vendors` | 获取所有供应商 | 无 |
| `vul_vendor_products` | 获取供应商的产品 | vendor |
| `vul_vendor_product_cve` | 获取产品的 CVE | vendor, product |
| `vul_cve_search` | 查询特定 CVE | cve_id |
| `vul_last_cves` | 获取最新 CVE | number (默认5) |
| `vul_db_update_status` | 数据库状态 | 无 |

## 使用示例

### 在 VS Code 中配置 MCP 客户端

如果你使用 VS Code 和 Cline/Roo Code 插件，可以这样配置：

```json
{
  "cve-search_mcp": {
    "command": "docker",
    "args": [
      "run",
      "--rm",
      "-i",
      "cve-search-mcp"
    ],
    "disabled": false,
    "autoApprove": []
  }
}
```

### API 使用示例

```python
# 获取所有供应商
vendors = vul_vendors()

# 获取 Microsoft 的产品
ms_products = vul_vendor_products("microsoft")

# 获取 Windows 的 CVE
windows_cves = vul_vendor_product_cve("microsoft", "windows")

# 查询特定 CVE
cve_details = vul_cve_search("CVE-2024-1234")

# 获取最新 10 个 CVE
latest_cves = vul_last_cves(10)

# 检查数据库状态
db_status = vul_db_update_status()
```

## 环境变量

| 变量名 | 默认值 | 描述 |
|-------|--------|------|
| `PYTHONPATH` | `/app` | Python 模块路径 |
| `PYTHONUNBUFFERED` | `1` | Python 输出不缓冲 |

## 健康检查

镜像包含健康检查机制：
- 检查间隔：30秒
- 超时时间：10秒
- 启动时间：5秒
- 重试次数：3次

## 数据持久化

CVE-Search MCP 服务器是无状态的，不需要数据持久化。所有数据来自外部 CVE-Search API。

## 网络要求

- 需要访问 `https://cve.circl.lu/api/` 
- 如果网络受限，可能影响 CVE 数据获取

## 安全说明

- 镜像使用非 root 用户 `mcpuser` 运行
- 仅包含必要的系统工具
- 定期更新基础镜像以获取安全补丁

## 故障排除

### 常见问题

1. **网络连接问题**
   ```bash
   # 测试网络连接
   docker run --rm cve-search-mcp curl -s https://cve.circl.lu/api/browse
   ```

2. **MCP 服务器启动失败**
   ```bash
   # 查看详细日志
   docker run --rm cve-search-mcp python -c "import main; print('Dependencies OK')"
   ```

3. **依赖安装问题**
   ```bash
   # 重新构建镜像
   docker build --no-cache -t cve-search-mcp .
   ```

## 参考链接

- [原始项目](https://github.com/roadwy/cve-search_mcp)
- [CVE-Search](https://github.com/cve-search/cve-search)
- [CVE-Search API](https://www.cve-search.org/api/)
- [Model Context Protocol](https://modelcontextprotocol.io/)
- [FastMCP](https://github.com/jlowin/fastmcp)

## 许可证

MIT License - 遵循原始项目许可证